[["index.html", "Développement doutils danalyses pour les données de PTR-ToF-MS Remerciements", " Développement doutils danalyses pour les données de PTR-ToF-MS Joris Huguenin 2021-08-23 Remerciements Merci à tous "],["introduction-générale.html", "Introduction générale", " Introduction générale À linstar de lannée 2021, ce stage de M2 a été un peu particulier. Lors de lélaboration du sujet en janvier, nous avons proposé un sujet résolument tourné vers lanalyse de données. Il sest avéré que mon temps de stage sest réparti différemment. Le sujet du stage a évolué afin de mieux couvrir lensemble du travail effectué durant ces mois. Le chapitre 1 rend compte de ces aspects en détaillant le contexte de ce stage, louverture qui a été amorcée afin de rendre compatible le travail de la plateforme avec les orientations publiques vers la science ouverte et de la relation entre les analystes et les praticiens. Le chapitre 2 est dédié à linstrument de mesure principalement utilisé lors du stage. Le PTR-ToF-MS analyse les molécules volatiles. Après une présentation de cette technique et de notre appareil, je détaillerais les données récupérées ainsi que le package R que jai écrit pour procéder à lanalyse. Nous ferons un comparatif entre cette technique et la GC-MS qui est régulièrement utilisé en parallèle. Enfin, le chapitre 3 détaille les opérations mathématiques utilisées pour lanalyse des données. Je développerais les choix fait quand aux prétraitements et à lalignement des spectres. Je présenterais également les algorithmes implémentés dans le package, en particulier celui de la MCR-ALS. À la fin de ce rapport se trouve un glossaire des termes techniques et des acronymes. Avant celui-ci, je livre une conclusion générale sur ce stage ainsi que sur le travail quil reste à accomplir. Un soin particulier a été apporté à la découpe des chapitres. Bien que la mode des rapports et articles scientifiques soit au storytelling1, les trois chapitres suivant peuvent se lire dans lordre dintérêt du lecteur. mode que jai toutefois essayé de respecter. "],["chap1.html", "1 Le métier dingénieur de plateforme 1.1 Contexte 1.2 Science ouverte 1.3 Plan dexpérience en écologie chimique 1.4 Conclusion partielle", " 1 Le métier dingénieur de plateforme 1.1 Contexte Depuis le 04 novembre 2019, joccupe un poste dingénieur affecté à la Plateforme dAnalyses Chimiques en Écologie (PACE). La PACE, créée en 2000, est spécialisée dans lanalyse chimique pour la communauté de recherche liée à lécologie, lenvironnement et la biodiversité. La PACE comporte six permanents et un CDD. Cette plateforme est un service mutualisé du LabEx CeMEB depuis 2011. Lunité de rattachement est le Centre dEcologie Fonctionnelle et Evolutive de Montpellier (CEFE UMR5175 du CNRS). Cette unité mixte possède quatre tutelles ; le CNRS, lUniversité de Montpellier (UM), lÉcole Pratique des Hautes Etudes (EPHE) et lInstitut de Recherche pour le Développement (IRD), ainsi que trois partenaires ; lUniversité Paul Valéry Montpellier 3 (UPVM3), SupAgro Montpellier et lINRAE. À ce titre, bien que rattachée au CEFE, la PACE accueille des projets de recherche issus des 12 unités du CeMEB (850 personnels permanents) mais aussi de toute la communauté académique nationale ou internationale. LUniversité de Montpellier a été porteuse dun projet GEPETOs dont lobjet était de financer un projet CPER (Contrat Plan Etat Région) mobilisant des financements FEDER pour lachat dun spectromètre de masse en temps réel permettant datteindre des mesures de cinétique fine, abrégé en PTR-ToF-MS (Proton Transfert Reaction Time of Flight Mass Spectrometry) pour la PACE. Le chapitre 2 revient en détail sur cet instrument. Ce projet GEPETOs comporte une part dédiée au recrutement dun ingénieur détude devant bénéficier dune formation en double compétence de niveau Master 2. Avec mes responsables hiérarchiques nous avons choisi le M2 SSV qui me permettait de renforcer mes connaissances statistiques. Le stage du second semestre cest donc effectué sur la plateforme PACE. Plusieurs étapes ont été définies pour lensemble du contrat : mise en place des procédures de recueil et de contrôle des données ; adaptation des méthodes danalyse mathématiques pour répondre aux besoins spécifiques du PTR-ToF-MS ; organisation de la mise en forme et du stockage des données ; assurer la maintenance des bases de données contenant les data produites par linstrument et les résultats des analyses. Il était prévu que le point 2 soit particulièrement mis en avant lors de ce stage. En réalité lensemble des points ci-dessus a été mobilisé. Cette introduction du contexte me permet de décrire létat desprit général lié à ce stage. Effectué sur mon lieu de travail, il y avait une dualité entre la nécessité dencadrer les utilisateurs de la platerforme et la possibilité offerte dun temps de réflexion et dexploration. La première modalité imposait le tempo, du pragmatisme et un calendrier à respecter. Ce printemps-été 2021 était particulièrement attendu pour deux raisons. Il fallait en quelque sorte rattraper le travail qui navait pu être effectué lors du confinement général du printemps 2020. De plus, les possibilités de lappareil commence à être connues et celui est beaucoup demandé. De plus, lintitulé initiale de ce stage était \"Analyse descriptive des données PTR-TOF-MS des COV émis lors du cycle larvaire de la guêpe de lamande (Eurytoma amygdali). Je devais accompagné une doctorante dans son travail danalyse. Nous avons commencé les expériences dés février lors de la période de fleuraison des amandiers. Après deux mois dexpériences, la quantité de données recueillies était particuliérement importante. La doctorante, ayant commencé sa thèse en janvier et après avoir les expériences avec le timing imposé par la nature, a pu reprendre un rythme normale de thèse et se plonger dans la bibliographie. De mon coté, jai participé à la mise en place dautres expériences sur lesquelles nous reviendront dans ce rapport. Jai également pu prendre du recul sur mon activité et la repenser afin quelle cadre avec la politique actuellement de science ouverte. Ce stage ma ainsi permit dorienter les outils numériques que je met à dispositions des chercheurs vers une science reproductible. 1.2 Science ouverte Durant cette période de stage, le gouvernement français a mis en place le Deuxième Plan pour la science ouverte qui définit les actions mises en place sur la période 2021-2024. Le plan est détaillé dans ce document dont je recommande vivement la lecture. Ce guide de route possède les défauts propres à lépoque2. Ceci étant, à léchelle de la communauté scientifique française, ce plan permettra une large diffusion du savoir et de la culture scientifique grâce à des actions regroupés dans quatre axes : généraliser laccès ouvert aux publications; généraliser lobligation de publication en accès ouvert des articles et livres issus de recherches financées par appel à projets sur fonds publics; soutenir des modèles économiques dédition en accès ouvert sans frais de publication pour les auteurs; favoriser le multilinguisme3 et la circulation des savoirs scientifiques par la traduction des publications des chercheurs français; structurer, partager et ouvrir les données de la recherche; mettre en uvre lobligation de diffusion des données de recherche financées sur fonds publics; créer Recherche Data Gouv, la plateforme nationale fédérée des données de la recherche; promouvoir ladoption dune politique de données sur lensemble du cycle des données de la recherche, pour les rendre faciles à trouver, accessibles, interopérables et réutilisables (FAIR); ouvrir et promouvoir les codes sources produits par la recherche; valoriser et soutenir la diffusion sous licence libre des codes sources issus de recherches financées sur fonds publics; mettre en valeur la production des codes sources de lenseignement supérieur, de la recherche et de linnovation; définir et promouvoir une politique en matière de logiciels libres; transformer les pratiques pour faire de la science ouverte le principe par défaut. développer et valoriser les compétences de la science ouverte tout au long du parcours des étudiants et des personnels de la recherche; valoriser la science ouverte et la diversité des productions scientifiques dans lévaluation des chercheurs et enseignants-chercheurs, des projets et des établissements de recherche; tripler le budget de la science ouverte en sappuyant sur le Fonds national pour la science ouverte et le Programme dinvestissements davenir Les axes concernant le code et les données me concerne directement. Par mon travail, je produit des données ainsi que le code permettant lanalyse de celle-ci par mes collaborateurs. Le code est écrit en langage R sous la forme dun package, proVOC, déposé sur gitHub. Il génère un workflow qui sauvegarde les paramètres et les données utilisés lors de lanalyse. Le dépôt sur un git permet louverture de ce code. Il est toutefois prévu deffectué une migration sur gitLab afin de favoriser lutilisation des logiciels libres. Par ailleurs, je souhaite développer un module permettant de convertir les data machines dans un format adapté à la futur plateforme Recherche Data Gouv. Ce module facilitera la production de data paper dont jai découvert lexistence au cours des journées casuHAL 2021. Grâce à deux demi-journées de formation sur Rmardown et sur la création de package, jai pu intégrer la génération de rapport automatisé dans le package4 qui est un premier pas vers lécriture automatisé des data paper. Jai également découvert et testé les packages et templates permettant de créer sous R un document découpé en chapitre. Jutilisais déjà Rmarkdown depuis un certains temps mais le passage à Bookdown et memoiR a demandé un temps dadaptation plus long que prévu. Ceci étant, ça na pas été en vain puisque jai eu plusieurs retours enthousiastes de collègues en vu dune formation sur ces packages. Jenvisage, une fois ce rapport terminé, de développer un clone de memoiR (avec laccord de lauteur) sur le style de EcoFoG afin de mettre à disposition aux membres du CEFE un templates clé en main. Ceci permettra de favoriser lécriture de rapport par des logiciels libres et daméliorer la reproductibilité de la science. 1.3 Plan dexpérience en écologie chimique Le chapitre suivant décrit la technique de la PTR-ToF-MS. Nous avons ici juste besoin de savoir que cette technique analyse en continue les molécules volatiles émises par léchantillon. Linstrument ne peut analyse que un échantillon à la fois mais plusieurs peuvent se succéder au sein de séquence. Durant la période de stage, jai accompagné plusieurs séries dexpériences. Les modèles biologiques analysés varient à chaque expérience. Les plans dexpériences ont été conçu en dialoguant avec les utilisateurs. Bien souvent, ils avaient en tête lexpérience qui répondait le mieux possible à leur question biologique. Janticipais les incohérences techniques et joptimisais les paramètres de linstrument. Avec le recul, je me suis rendu compte que mes connaissances acquissent en cours de recueil planifié de données nétaient pas pleinement exploité. Un des problèmes principales est dû à la contamination de la ligne et de linstrument par léchantillon précédent. Nous pouvons analyser ces expériences pour repérer les erreurs commises. 1.3.1 Détection des traces dun complément alimentaire Cette expérience avait pour objectif de mesurer la diffusion de lodeur de nourriture (pour des poules) dans quatre sites dun mésocosme constitué de deux compartiments. La figure ?? illustre cette prise de mesure. Les sites étaient localisés dans la mangeoire (s1, compartiment 1), au centre du compartiment 1 (s2), à la jonction des deux compartiments (s3, côté comportiment 2, figure ??) et au fond du compartiment 2 (s4). La nourriture au sein de la mangeoire était soit de la nourriture témoin (T) soit dopée par de lhuile essentiel (A et B). Il y avait 5 mésocosmes pour chaque modalité. PTR-ToF-MS relié à lun des quatre site de mesure dun mésocosme Dans la théorie dune expérience totalement randomisée, il aurait fallut définir lordre aléatoire de chacune des 60 acquisitions5. Dans la pratique, cette expérience nécessitait de déplacer linstrument dun mésocosme à lautre entre chaque acquisition. Cette manipulation aurait drastiquement augmenté la durée de lexpérience. Nous avons donc tiré au hasard lordre de passage de chaque mésocosme, effectué un blanc et les acquisitions sur les quatre sites de mesures puis terminé par un nouveau blanc. Il aurait été juste de tirer au hasard lordre de passage des sites. Pour autant, nous avons opté pour une hypothèse forte de commencer par la site le plus éloigné de la mangeoire (s4, s3, s2, s1) afin que les potentielles traces ne soient pas contaminées par une odeur plus forte. Dans les faits, nous laissions assez de temps entre deux mesures pour renouveler plusieurs fois le volume danalyse à lintérieur de linstrument ce qui permettait disoler les mesures. Après coup, je pense quil aurait été bon de procédé malgré tout à une randomisation de lordre des sites au sein dun mésocosme. Sonde à proximité de la mangeoire Nous avions également une seule journée pour effectuer lensemble des acquistions, ce qui a été juste suffisant. Nous navons pas pu effectuer de répétition sur un même échantillon. Lanalyse des data a été effectué par le post-doc en charge de lexpérience. Je nai pas de retour sur des potentiels contaminations intra et inter échantillons. Bien que la réalisation de cette expérience est statistiquement discutable, elle a été réalisé en tout début de la période de stage et ma permit la réflexion sur comment intégrer mieux la planification dexpérience. 1.3.2 Caractérisation de COV de lamandier Ce travail sinscrit dans la première année dun projet de thèse et consistait à analyser les COV émis par les différents organes (bourgeon, fleur, feuille, fruit) des amandiers. Pour des raisons de calendrier, jai aidé à la mise en place des expériences début février puis à la formation de la doctorante. Une fois cette dernière autonome avec linstrument, jai peu assisté au suivi de lexpérience. Jai toutefois soumis lidée de suivre le débourrement dune fleure avec le PTR-ToF-MS. Nous avons suivi durant un week-end les COVs émis par un bourgeon que nous avons isolé du reste de la plante. Ce bourgeons avait été sélectionné car il était proche de la floraison. Ainsi, nous avons pu recueillir les odeurs émises avant, pendant et après le débourrage. Cependant, nous navons pu obtenir quune seule unité expérimentale pour cette expérience. Par ailleurs, nous avions filmé le bourgeons durant lexpérience mais la caméra sest éteinte après quelques heures. Ainsi, nous navons pas de témoin validant lheure de phénomène. Les données techniques et les résultats de lanalyse sont détaillés à la section 3.2.1. Nous retenterons probablement cette expérience en février 2022 sur plusieurs unités expérimentales, en privilégiant une série de photo plutôt quun film. Cette expérience a permis de mettre en avant les capacités de lappareil et a fait germer plusieurs idées. Nous avons fait plusieurs réunions préparatoires pour mettre en uvre lune delles. Nous souhaitons analyser la réponse chimique dune fleure après la diffusion du bruit de son pollinisateur. 1.3.3 Étude de lémission journalière des lavandes et des figuiers Lexpérience sur les lavandes présentée ici sinscrit dans un cadre expérimentale plus vaste sintéressant aux phénomènes liées à lozonation. Je ne reviendrais pas dans ce rapport sur la partie ozonée. Cependant, nous nous sommes intéressé aux variations journalières dans des conditions non ozonée (plantes témoins). Nous avons mis en place quatre chambres de mesure permettant chacune soit disoler un plant de lavande soit dêtre un blanc. Ces chambre de mesure sont des cylindres en plastiques, ventilé, de volume équivalent et relié chacun à un flux dair propre dun débit de 5 litres/min. La longueur et le volume des lignes reliant les chambres à linstrument de mesure nétaient pas identique. Nous avons lancé des acquisitions sur les quatre chambres en série durant 48h. Nous avons répété ce processus deux fois, pour obtenir neuf plants au total dans notre plan dexpérience. Pour les lavandes, il ny avait quune modalité (plante témoin). Toutefois, un des quatre moteurs permettant la ventilation à lintérieur de la chambre ne fonctionnait pas. Nous avons décidé que cette chambre serait le blanc. Là encore, cette décision est critiquable. Dun côté, il fallait que le moteur HS soit celui de la chambre blanc afin de ne pas créer artificiellement les modalités plante témoin ventilée et plante témoin non-ventilée. Dun autre côté, nous comparons un blanc non-ventilé à des plantes ventilées. Au regard de débit dair pure de 5L/min, nous avons jugé ce biais négligeable. En revanche, nous aurions pu, au prix de quelques branchements et rebranchements supplémentaires, déplacer le moteur défectueux dune chambre à lautre entre les répétitions. Ceci aurait permis de mieux répartir lerreur expérimentale due aux lignes de mesure. Ceci étant, les résultats présentés dans la section 3.2.2 sont satisfaisant. Quelques jours après lexpérience avec les lavandes, nous avons réutilisé le même dispositif avec des figuiers. Le temps danalyse a été augmenté pour passer à 5 jours. La chambre blanc est resté la même (non ventilée). Cette fois, les plantes étaient soit polinisées soit non-polinisées (témoin). Nous avons décalé la plante témoin dune chambre à chaque répétition malgré quun statisticien puriste aurait probablement tiré au sort à chaque répétition, au risque de tomber trois fois sur la même chambre. Je nai pas aidé à lanalyse de cette expérience et ne peut pas me prononcer sur la pertinence des choix effectués. 1.4 Conclusion partielle Jai commencé ce métier en novembre 2019. En raison des conditions sanitaires et de la formation continue en M2 SSV, jai une vision légèrement biaisée dune année standard sur ce poste. Pour autant, je pense avoir trouvé le bon équilibre entre dun côté le développement doutils numériques résolument orienté utilisateurs et qui entre dans le Deuxième Plan national pour la science ouverte et de lautre côté laccompagnement des utilisateurs de la conception de leurs expériences à lacquisition. Le temps annuel consacré à chacune de ces facettes est plutôt équilibré bien que les saisons chaudes soient bien évidemment plutôt dédiées au terrain. Après ces quelques descriptions dexpériences, je propose une description plus détaillée de linstrument PTR-ToF-MS et de son environnement dans le champs de la spectroscopie de masse, chapitre 2, mais un lecteur pressé de connaître les conclusions de ces expériences peut sauter au chapitre 3. References "],["chap2.html", "2 Présentation de la PTR-ToF-MS 2.1 Une bréve histoire de la PTR-ToF-MS 2.2 Instrumentation générale 2.3 Technique rivale ou alliée de la GC-MS ? 2.4 package proVOC", " 2 Présentation de la PTR-ToF-MS De très nombreux projets de recherches issus du CeMEB nécessitent lanalyse de Composés Organiques Volatiles (COV ou VOC en anglais) aussi communément appelés odeurs. Les COVs sont omniprésents dans la nature et permettent, avec les autres sens, une organisation du vivant en agissant comme vecteurs dinformations de la médiation chimique. Par lacquisition dun PTR-ToF-MS, la communauté souhaitait lever trois verrous techniques : lappareil permet un fonctionnement en flux continu avec une résolution temporelle très fine (fréquence danalyse allant jusquà 10 scans par seconde), permettant ainsi le suivi des cinétiques démissions de COV. Cet instrument simplifie drastiquement et affine les expériences cinétiques effectué par des mesures ponctuelles de GC-MS; le PTR-ToF-MS possède une excellente résolution en masse qui facilite lidentification des molécules. Un spectre est composé de plus de 140 000 mesures de masses couvrant une large gamme des masses des COV biologiques (de 70 à 500 m/z). Lappareil possède donc une résolution environ mille fois supérieure par rapport à un simple quadripôle (PTR-MS) qui fournit des m/z à lunité de masse atomique (uma ou Dalton Da); le seuil de détection extrêmement bas, de lordre du ppt (part per trillion), permet une sensibilité adaptée à la mesure de trace. 2.1 Une bréve histoire de la PTR-ToF-MS Durant la décennie 1990, le Institut für Ionenphysik der Leopold-Franzens-Universität dInnsbruck en Autriche développe un nouvel instrument pour lanalyse chimique des gaz. En travaillant avec la Universitiitsklinik fiir Innere Medizin, léquipe menée par Lindinger développe un spectromètre en phase gazeuse qui ionize les molécules grâce à un gaz neutre ((W. Lindinger, Leiter, et Andriollo 1991) et (W. Lindinger, Hirber, et Paretzke 1993)). Ils comprennent rapidement lavantage dutiliser un proton (apporté à la réaction sous la forme H3O+) par rapport aux ions Kr+ et Xe+. Ils publient une sorte de preuve de concept en 1994 (Lagg et al. 1994) et détaillent plus finement linstrumentation et les réactions chimiques (Hansel et al. 1995)6. En 1998 sort larticle qui fait désormais référence, (W. Lindinger, Hansel, et Jordan 1998), signé par le trio Lindinger, Hansel et Jordan (et sa version courte (W. Lindinger et Jordan 1998)). Ionicon commercialise la même année le premier PTR-MS. Cette technique se déploie rapidement dans les sciences de latmosphère, médicales et biotech ((Babcock et Adams 2001)) permettant la détection de traces de COV. Rapide et sensible, la PTR-MS élimine les désavantages de la GC-MS. Cependant, la PTR-MS détecte de la masse nominale des ions. Un échantillon complexe peut contenir plusieurs ions isobares7. Il convient alors de gagner en résolution de masse et séparer ces isobares. (Jordan et al. 2009) revient sur les tentatives les plus concluantes ((Blake et al. 2004), (Ennis et al. 2005), (Inomata et al. 2006) et (Tanimoto et al. 2007) ) avant de proposer son approche : la PTR-ToF-MS. Développé en collaboration avec la précédente équipe, le minutieux article de (Graus, Müller, et Hansel 2010) conclu superbement la vingtaine dannées de développement nécessaire à cette technique. Les années suivantes permmettront simplement une amélioration des différentes parties de linstrument. Par ailleurs, cest au tour des mathématiciens dapporter leur contribution et en particulier à léquipe de Cappellin avec deux articles. Le premier, (Cappellin et al. 2010), permet de mieux estimer la masse exacte de chaque ion détecté. Le seconde, (Cappellin et al. 2011), offre une méthodologie détaillée de lutilisation du PTR-TOF-MS de lacquisition à la fin de lanalyse. Puis en 2015, (Holzinger 2015) propose un logiciel pour lanalyse des data mais cette tentative na pas été suivi par la communauté dutilisateur. Il existe désormais un nombre important darticles utilisant la PTR-TOF-MS. Bien entendu, des outils commun de chimiométries ont été utilisés pour renforcer les résultats, (Deuscher et al. 2019). Mais cela sera abordé dans le chapitre suivant. Par ailleurs, je suppose que la prochaine avancée majeure viendra dune technologie permettant de discriminer les isoméres8 (Claflin et al. 2021).9 Par exemple, cela permettrait de séparer les différents monoterpènes. Actuellement, ce désavantage est combler par le couplage de la PTR-TOF-MS avec une seconde technique danalyse chimique. Ce court historique montre toutefois que la collaboration entre physiciens, chimistes, biologistes et mathématiciens est fructueuse et promis à un bel avenir. 2.2 Instrumentation générale Comme nous lavons vu précédemment, le PTR-TOF-MS est conçu pour analyser finement la masse moléculaire des échantillons. Pour cela linstrument aspire un débit dair constant de 100 ml/min10. Cet air in sur la figure ?? peut être diluée par un gaz propre (pour éviter la saturation) ou étalon (pour la calibration) puis est injecté dans le réacteur (FIMR pour focusing ion-molecule reactor). Dans cette chambre, des ions H+ sont également injecté à débit constant afin dionizer les molécules de léchantillons (Proton-Transfer-Reaction). Schéma de la chambre dionisation (Reprinted with permission from Krechmer et al. (2018). Copyright 2021 American Chemical Society.) Il est important de comprendre que, contrairement à une ionization par électron11, il ny a quasiment pas de fragmentation moléculaire. En revanche les ions ont une masse molaire de plus(un proton) que les molécules initiales. Par exemple, le linalol, un COV fortement produit par la lavande, a une masse molaire de 154,249 g/mol mais sera detecté à 155,256 g/mol. Par ailleurs, le nombre dions MH+ dépend du taux de protonation de la molécule M. Sous forme dions, léchantillon peut être focalisé par un champ électromagnétique généré par un quadripole et envoyé dans la partie TOF. Une fois dans la colonne, lénergie potentiel dun pulse électrique à 25kHz est convertie en énergie cinétique par les ions propulsés. À énergie constante, la masse fait la différence lors de la mesure du temps de vol (TOF, figure ??). Ainsi les ions les moins lourds arrivent en premiers sur le détecteur. Après calibration, une simple conversion temps de vol/ masse permet de connaître lintensité de chaque masse dun échantillon. Schéma de la colonne TOF et du détecteur MS (Reproduit de larticle Graus, Müller, et Hansel (2010), consulatable ici : https://www.sciencedirect.com/science/article/pii/S1044030510001005#fig1 Pour une compréhension plus exhaustive, je recommande la lecture des articles de Hansel et al. (1995) pour la partie PTR-MS, de Graus, Müller, et Hansel (2010) pour la partie TOF et de Krechmer et al. (2018) spécifique à linstrument utilisé au CEFE. 2.2.1 présentation des spectres spectre MS Nous pouvons à présent nous intéresser aux spectres à analyser. Jai représenté sur la figure ?? un spectre de trois plants de lavandes acquis autour de 8h du matin fin juin. Une figure identique mais dynamique peut se télécharger ici12. Cette figure dynamique permet deffectuer des zoom afin davoir une compréhension plus précise quavec la simple figure ??. Les pics sont extrêmement fins et centrés autour des masses unitaires. Cela sexplique facilement au regard de la masse des atomes composants les VOC (H, C, O pour lessentiel) sur le tableau de Mendeleiev13. Il y a un plusieurs ordres de grandeur14 entre les pics très intenses et ceux faibles. Cette intensité ne présage rien quand à limportance de ce pic dans lanalyse. La plage spectral de linstrument est de 70 à 500 g/mol. Cela est fixé par le constructeur pour des raisons techniques alors quil y a de nombreuses molécules dintérêts de masses inférieurs à 70g/mol et peu de molécules naturelles dépassant les 250 g/mol. Ces considérations prises en compte, nous obtenons pour chaque spectre un vecteur brute de 158 768 points. Ces spectres sont réduits, après alignement (voir section 2.4.1 et 3.1 ) à une taille inférieur à 50 000 points tout en gardant une résolution de 10-3 g/mol. De plus, la PTR-TOF-MS a été développée afin danalyser des cinétiques démissions. Dans nos cas, nous enregistrons des spectres de quelques secondes consécutivement durant plusieurs minutes à plusieurs jours. Pour une expériences, nous générons ainsi des dizaines, voir des milliers, de spectres. Ceci étant, nous pouvons dés à présent percevoir les problèmes liés aux temps de calculs que nous allons rencontrer et la nécessité de développer des outils optimisés pour analyser de tels objets. 2.3 Technique rivale ou alliée de la GC-MS ? La métabolomique est dernier maillon de la chaîne -omic. Il se concentre sur lanalyse des petites molécules produites par un système biologique. Les deux domaines danalyses sont la résonance magnétique nucléaire (NMR) et la spectroscopie de masse (MS). Pour lanalyse des VOC en spectroscopie de masse, la technique de GC-MS est clairement la plus utilisée à lheure actuelle. La GC-MS, utilisé depuis des décennies, est largement implanté dans le paysage scientifique international. De plus, de nombreux logiciels performant15 existent. Il est légitime de se poser la question de la nécessité dutilisation des deux techniques16. Premièrement, la GC-MS accumule les VOC dans des pièges chimiques17 puis les analyses dans un second temps La durée daccumulation dans le piège est de lordre de la dizaine de minute. La PTR-TOF-MS a une sensibilité accru permettant lacquisition de spectres à une cadence de 25kHz. Afin daugmenter le ratio signal sur bruit et de drastiquement réduire la quantité de data généré, ces spectres sont additionnés les uns aux autres sur des durées dacquisitions plus longues18. En répétant ces acquisitions, la PTR-TOF-MS permet lanalyse cinétique dun phénomène. Analyse statique contre analyse dynamique. Le prix de cette sensibilité est comme bien souvent une sélectivité dégradée. Ainsi la GC-MS, a contrario de la PTR-TOF-MS, peut discriminer les isomères. Cela est permis grâce à la fragmentation des molécules lors de létape dionisation par un électron qui intervient après la phase de chromatographie. Bien que les molécules analysées soient les même, les approches et résultats sont donc bien différents. De plus, il est souvent intelligent de croiser ces deux techniques (Majchrzak et al. 2018). De façon empirique, le PTR-TOF-MS analyse séquentiellement plusieurs échantillons. Il est aisé de collecté les VOC pour le GC-MS juste avant ou après une séquence dédiée au PTR-TOF-MS. Nous pouvons ainsi, par exemple, obtenir deux ou trois analyses ponctuelles de GC-MS lors dune journée entière danalyse PTR-TOF-MS. Nous combinons la sensibilité et la spécificité des deux techniques. Les données obtenues en GC-MS sont donc plus complexes quen PTR-TOF-MS. Chaque échantillon est représenté par une matrice ayant une dimension pour le temps de rétention et une dimension pour le spectre de masse. Il nest donc pas possible de réutiliser tels quels les outils numériques de la GC-MS. Cependant, il serait dommage de ne pas piquer les idées déjà existantes. Jai donc créer un package R spécifique à lanalyse des données du PTR-TOF-MS mais en minspirant largement de ce qui se fait sur dautres techniques : workflow (idée piquée à MZmine), bucketing (pratique courante dans la RMN), chimiomètrie (largement utilisée pour lanalyse des spectres optiques) ; ou en utilisant des packages destinés à dautres méthodes (MALDIquant dont la transparence du nom laisse peu de doute sur la méthode ciblée par ce package) 2.4 package proVOC Comme expliqué dans la section sur la science ouverte ( 1.2), ce package peut se retrouver sur ce dépôt Git. 2.4.1 Explication général Lobjectif de proVOC est de permettre une vue densemble rapide19 pour les utilisateurs pressés danalyser leurs données sous R sans avoir besoin davoir une grande connaissance de ce langage. La fonction import_sp() constitue la première étape de lanalyse. Les données contenues dans des fichiers .h5 générés par notre instrument sont importées dans lespace de travail (Fischer et al. 2021). Après cette étape, les spectres sont automatiquement alignés puis réduit. Les détails à propos de lalignement des spectres sont données dans la section 3.1. Pour létape de réduction, jai défini empiriquement de supprimer chaque colonne (masse) qui ne possédait aucune ligne (intensité) supérieur à un seuil. Ce seuil est calculé pour chaque jeu de donnée comme égale à 20 fois lécart-type médian de chaque masse20. Il est probable que cette étape de réduction peut être optimisé davantage mais je reviens sur les perspectives daméliorations du package dans la section dédiée, 2.4.4. Passé ces étapes, la fonction met en forme les données dans un objet list, récupère les metadata (date et heure dacquisition) puis détecte les pics grâce à la fonction detectPeaks() du package MALDIquant et calcule les AUC grâce à la function AUC() du package DescTools. Enfin, cet liste nommé sp est sauvegardé en .Rdata. Ce travail préliminaire peut être long. Une fois effectué, limport permet à lutilisateur de lancer facilement une série danalyse pour explorer rapidement son jeu de donnée. Pour cela, il lui suffit de modifier des options dans un workflow : # Workflow pour l&#39;analyse : mt &lt;- list(&quot;h5&quot; = mt_h5, # Don&#39;t touch &quot;acq&quot; = which(mt_h5$use4analysis == TRUE), # Don&#39;t touch &quot;wd&quot; = sp$h5$wd, # Don&#39;t touch #__________________________________# [] # graphe pour visualiser les spectres de masses de chaque acquisition : &quot;view_plot&quot; = FALSE, # Si TRUE, graphe moyen de chaque acquisition, # sinon precisez le numero d&#39;une ou plusieurs # acquistion(s). (ex : # c(200,300,400) # mt_h5$end # c(mt_h5$start, mt_h5$end) &quot;view_each.group&quot; = FALSE, # FALSE ou le nom d&#39;une meta colonne # (&quot;XXX&quot; de mt_h5$XXX) pour les graphes # larges ou centres sur un seul pic. &quot;view_plot_xmin&quot; = 70, &quot;view_plot_xmax&quot; = 250, # ou ... &quot;view_plot_peak&quot; = FALSE, # c(59,73,81,93,109,127,137,143,153) ou # False ou c(61,...) Permet de ne regarder # qu&#39;un seul pic #__________________________________# [] # ICA &quot;ICA&quot; = FALSE, &quot;ICA_AUC&quot; = TRUE, &quot;nc&quot; = 6 #__________________________________# ) PTR_MS_analysis(sp, mt) # debute les analyses Lobjet mt peut être sauvegardé pour se souvenir des paramètres utilisés lors de lanalyse. Nous pouvons détailler ci-dessous quelques options. 2.4.2 analyse AUC #__________________________________# # Aire sous la courbe (AUC) : &quot;AUC&quot; = TRUE, &quot;AUC_plot_exp&quot; = FALSE, # Si TRUE, l&#39;axe &#39;y&#39; est exponentionnelle. &quot;AUC_each.group&quot; = FALSE, # Si l&#39;argument est le nom d&#39;une meta colonne # ( &quot;XXX&quot; de mt_h5$XXX) chaque groupe de cette # colonne aura son graphe. Sinon FALSE. &quot;AUC_each.Mass&quot; = TRUE, # Si TRUE, un graphe pour chaque masse &quot;M.num&quot; = c(81, 137, 153), # Les masses analysees (utilise pour AUC) &quot;AUC_plot_dy&quot; = TRUE, # Si FALSE, plot exporter en .tiff. Si TRUE, plot # exporter en .html (dynamique) &quot;AUC_format&quot; = &quot;date&quot;, # L&#39;axe du graphe est base sur une duree (&quot;time&quot;) # ou sur la date et heure d&#39;acquisition (&quot;date&quot;) #__________________________________# spaghettis plot La figure ?? montre lévolution quotidienne de lémission des molécules de masse 137 (de 136.5 à 137.5) de trois plants de figuiers dont le cadre expérimentale est décrit section 1.3.3. Chaque plante est analysée par cycle de 384 secondes composé de 24 acquisitions de 16 secondes (regroupées en trois parties pour des raisons techniques). Vous pouvez télécharger cette figure ici afin de zoomer plus facilement. Nous pouvons observer que le début de chaque cycle denregistrement est systématiquement impacté par la mesure précédente et le volume mort des lignes de mesures. Nous pouvons justifier ce biais expérimentale et donc le supprimer en ne prenant pas les 8 premières acquisitions de chaque cycle. Ce bloc doptions est vraiment très simple dutilisation. En jouant sur les masses et les modalités incluses dans le graphe, les utilisateur arrivent facilement à appréhender lévolution des VOC de leur système. Pour autant, nous reviendrons en 2.4.4 sur lutilisation de lAUC et sa méthode de calcule qui impact grandement ce module. 2.4.3 Calibration, regression linéaire et rapport automatisé #__________________________________# # Calibration &quot;calibration&quot; = FALSE, &quot;cal_rapport&quot; = TRUE, # Redige un rapport automatise pour evaluer la qualite de la calibration &quot;cal_plot_exp&quot; = TRUE, # Les axes x et y sont exponentielles ? &quot;M.conc&quot; = c(1.008, 1.018, 1.013, 1.014, 1.013, 1.013, 1.015, 1.006, 1.007, 0.994, 1.013), # La concentration, en ppm, de chaque masse, # par defaut C = 1.000 ppm. (1 ou FALSE) #__________________________________# Afin de vérifier la calibration de lappareil, jutilise un gaz étalon que je dilue avec un gaz pure lors des mesures de calibration. Jai développé un script pour analyser cette calibration. La sortie de ce script se fait sous forme de rapports automatisés basé sur des régressions linéaires simples. Jai eu pour projet de développer cela en combinant les différentes masses et en proposant des tests de validation. La base de ce script peut également être reprise pour mesurer la concentration de différentes molécules. Ceci étant, le manque de temps et le côté monovariable ont largement freiné ce projet. Dautant que nous allons le voir, le travail ne manque pas. 2.4.4 Perspective Dans cette partie, je nai pas développé les analyses plus poussés (alignement et chimiométrie) qui sont expliqués dans le chapitre suivant. Nous avons simplement vu le principe de base de la PTR-TOF-MS ainsi que les modules de base de lanalyse : obtenir le graphe des spectres de masses, le suivi des AUC et le calcul de concentration. Le package proVOC permet deffectuer ces opérations de façon simple et sans rien coder. De plus, il met à disposition les jeux de données pour que les utilisateurs puissent soit appliquer leur propre traitement soit utiliser des modules avancés. Le package a été conçu pour assurer une reproductibilité des analyses. Lors de la conception de la structure du package, nous avions peu de recule sur lutilisation du PTR-TOF-MS. Désormais, je suis convaincu quil me faut développer la version 2 très prochainement. Trois grosses modifications vont être effectuées. La première est assez technique et concerne limportation de donnée : # Data importation and reduction #### f_h5 &lt;- dir(&quot;h5&quot;) %&gt;% grep(&quot;.h5&quot;, .) # localise h5 files ls_h5 &lt;- vector(&quot;list&quot;, length(f_h5)) # the acquisitions listes names(ls_h5) &lt;- nm_ls(f_h5) # and the name for (i in 1:length(ls_h5)) { ls_h5[[i]] &lt;- paste0(&quot;h5/&quot;, dir(&quot;h5&quot;)[f_h5[i]]) %&gt;% H5Fopen() # files import } mt_h5 &lt;- meta_h5(ls_h5) # make the meta file sp &lt;- sp_red(ls_h5, mt_h5) # spectra reduction sp$h5 &lt;- list(f_h5 = f_h5, ls_h5 = ls_h5, mt_h5 = mt_h5, wd = getwd()) h5closeAll() # close the connexion with the h5 files. # ls_h5 become NULL Les fonctions H5open() et H5close() du package rhdf5 permettent douvrir les fichiers h5 afin de les importer puis de les fermer. La fonction sp_red(), que jai écrite, est une meta fonction qui permet dimporter les spectres, les meta data, daligner les spectres, de supprimer les données inutiles et des détecter les peaks. Comme nous pouvons le voir, elle se trouve en sandwitch entre louverture de toutes les datas et la fermeture des données. Cette maladresse occupe de la RAM inutilement et ralentie beaucoup cette étape. Pour autant, toucher à la fonction qui importe les données et les mets en forme est une opération risquée qui met en péril la fonctionnalité des fonctions ultérieures. La seconde modification sera sur le calcul de lAUC. Initialement, je voulais trouver un moyen simple dexprimer les 50 000 points des spectres en une valeur plus acceptable pour de lanalyse chimiométrique. Javais donc piqué lidée du bucketing des communautés de RMN en calculant lAUC par masse unitaire (de M-0.5 à M+0.5). Cela permet dobtenir une matrice de seulement 400 colonnes environ. En réalité, cela masque les cinétiques des molécules isobares. De plus, jai découvert après coup une fonction très performante pour détecter les pics (2.4.1). Je peux donc remplacer les AUC unitaires par lintensité des pics. Il ny aura alors plus quune confusion sur les isomères mais qui correspond aux limites techniques de linstrument. Jaimerais également travailler sur lAUC des pics et leur déconvolution afin de savoir si de linformation y est cachée. La dernière modification se fera sur la structure : PTR_MS_analysis(sp, mt) # debute les analyses Une seule fonction permet de lancer la série danalyses précisé dans le workflow mt sur les data de lélément sp. La fonction PTR_MS_analysis() ne retourne rien, si ce nest des graphiques, des fichiers .csv ou des rapports automatiques. Jaimerais inclure le workflow à lintérieur de lobjet sp et le compléter au fur et à mesure. Ainsi lutilisateur pourrait lancer des opérations à la volée, par exemple (en reprenant le block AUC de la section 2.4.2) : # Aire sous la courbe (AUC) : sp &lt;- sp_AUC(sp, AUC_plot_exp = FALSE, AUC_each.group = FALSE, AUC_each.Mass = TRUE, M.num = c(81, 137, 153), AUC_plot_dy = TRUE, AUC_format = &quot;date&quot;) Cette forme franchement plus digeste permettra dinclure plus simplement une analyse PTR-TOF-MS dans un script ou un rapport Rmarkdown. Jespère avec ces modifications importantes rendre lanalyse plus optimisée en temps et répondre mieux aux attentes des utilisateurs. Ce package est sur GitHub depuis septembre 2020. Jai fait peu de pub car je connais ses limites et je souhaiterais corriger ses principales défauts avant de le proposer aux collègues des autres centres de recherche avec qui nous avons des contacts. Les retours sur les quelques démonstrations effectuées sont très positives et proVOC permettra (je lespère) de répondre positivement à un réel besoin. De plus proVOC est complètement cohérent avec les principes de lopen science développés au chapitre 1 et intègre des analyses chimiométriques qui sont détaillées au chapitre 3. References "],["chap3.html", "3 Méthodes Multivariées 3.1 Alignement et sélection de variable 3.2 Méthodes multivariées", " 3 Méthodes Multivariées Nous allons à présent nous intéresser aux algorithmes utilisés pour traiter les jeux de données générés par le PTR-TOF-MS. Ce chapitre est divisé en deux parties. Lors de lécriture du package, javais travailler sur différentes méthodes dalignement avant de marrêter sur lune delle. Le début de ce stage ma permis de reprendre ce travail avec des idées nouvelles que je présenterais dans une première partie. La deuxième partie présente lutilisation de la chimiométrie pour lanalyse de donnée, dabords avec la PCA puis avec deux méthodes moins populaires, lICA et la MCR qui ont lavantage chacune dessayer de décomposer les données en produits pures. 3.1 Alignement et sélection de variable Actuellement, le package utilise la fonction alignSpectra() du package MALDIquant. Lalignement est fortement lié à la détection de pic. Soit le modèle utilisé nest pas optimum et ajoute ou supprime des pics. Soit il crée un décalage trop important en alignant mal les pics se qui créer de la confusion lors de létape didentification. alignSpectra() est performant mais rencontre des limites sur les pics de faible ratio signal sur bruit, comme nous pouvons le voir sur la figure @ref(lav_align). Le bruit intensifie leffet vaguelette et génère de lambiguïté sur le nombre de pics présent. Par ailleurs, la fonction créé des pics négatifs qui faussent le calcul de lAUC. Jai trouvé un article très intéressant de Picaud et al. (2018) qui propose un algorithme pour supprimer la ligne de base, aligner les pics et les détecter. Larticle explique les problèmes de faire ces trois étapes successivement et propose donc une alternative. Nous avons discuté avec lauteur de sa solution. Malheureusement, le script est écrit en C++. Il est possible dutiliser ce langage sous R, via Rcpp par exemple, mais cela aurait demandé un peu trop de temps. Pour linstant, cette solution a été mise de côté mais pourra être exploré plus tard. De plus, Jean-Michel Roger ma proposé une approche basé sur lalgorithme COVSEL (Roger et al. 2011) pour résoudre notre problème. 3.2 Méthodes multivariées ### ACP ### MCR ### ICA 3.2.1 bourgeon blabla voir le détail section 1.3.2 3.2.2 lavande blabla voir le détail section 1.3.3 References "],["glossaire.html", "Glossaire", " Glossaire CEFE (UMR 5175) : Centre dÉcologie Fonctionnelle et Évolutive. Laboratoire daccueil situé sur le site de la DR13 du CNRS, route de Mende à Montpellier. COV (ou VOC) : Composé Organique Volatile. Molécules produites par des systèmes biologique et analyse par le PTR-ToF-MS. GC-MS : Gaz Chromatographie Mass Spectroscopy. Autre méthode danalyse des VOC, moins sensible mais plus discriminante que la PTR-TOF-MS. PACE : Plateforme dAnalyse Chimique en Écologie. Plateforme situé au sein de lUMR 5175. PTR-ToF-MS : Proton Transfert Reaction Time of Flight Mass Spectroscopy. Acronyme utilisé pour linstrument de mesure (le PTR-ToF-MS) et pour la méthode danalyse (la PTR-ToF-MS). Par abus de langage, lacronyme PTR-MS est réguliérement utilisé. "],["references.html", "References", " References "]]
